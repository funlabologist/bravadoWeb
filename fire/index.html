<html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoldierStorm</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Press Start 2P', cursive;
        }
        #gameCanvas {
            border: 4px solid #fff;
        }
        .screen {
            width: 800px;
            height: 600px;
            background-color: #000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
        }
        #splashScreen, #gameOverScreen {
            display: flex;
        }
        button {
            background-color: #f00;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            font-family: 'Press Start 2P', cursive;
        }
        h1 {
            font-size: 36px;
            margin-bottom: 20px;
        }
        #score {
            font-size: 24px;
            margin-bottom: 20px;
        }
		.floater {
    position: absolute;
    color: #ffff00;
	font-family: 'Press Start 2P', cursive;
    font-size: 24px;
    font-weight: bold;
    pointer-events: none;
    opacity: 1;
    transition: transform 1s ease-out, opacity 1s ease-out;
  }
    </style>
</head>
<body>
    <div id="splashScreen" class="screen">
        <h1>Soldier Storm</h1>
        <button id="startButton">Start Game</button>
    </div>
    <canvas id="gameCanvas" width="800" height="400" style="display: none;"></canvas>
    <div id="gameOverScreen" class="screen" style="display: none;">
        <h1>Game Over</h1>
        <div id="score"></div>
		<button id="playAgainButton">Play Again</button>
	</div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const splashScreen = document.getElementById('splashScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startButton = document.getElementById('startButton');
        const playAgainButton = document.getElementById('playAgainButton');
        const scoreElement = document.getElementById('score');

        //let gameLoop;
        let player, enemies, bonuses, score, timeLeft;
        const GAME_TIME = 60;

        const sprites = {
            player: [
                'assets/player_frame1.png',
                'assets/player_frame2.png',
                'assets/player_frame3.png'
            ],
            enemy: [
                'assets/enemy_frame1.png',
                'assets/enemy_frame2.png',
                'assets/enemy_frame3.png'
            ],
            bonus: 'assets/bonus.png',
            hud: 'assets/hud.png'
        };

        const sounds = {
            bgm: new Audio('assets/8bit-bgm.mp3'),
            jump: new Audio('assets/jump.mp3'),
            collect: new Audio('assets/collect.mp3'),
            enemyDeath: new Audio('assets/enemy-death.mp3'),
            gameOver: new Audio('assets/game-over.mp3')
        };

        sounds.bgm.loop = true;

        class Sprite {
            constructor(x, y, width, height, frames) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.frames = frames;
                this.currentFrame = 0;
                this.frameCount = 0;
                this.image = new Image();
                this.image.src = this.frames[this.currentFrame];
            }

            draw() {
                ctx.drawImage(this.image, this.x, this.y, this.width, this.height);

                this.frameCount++;
                if (this.frameCount >= 10) {
                    this.currentFrame = (this.currentFrame + 1) % this.frames.length;
                    this.frameCount = 0;
                    this.image.src = this.frames[this.currentFrame];
                }
            }
        }

        class Player extends Sprite {
            constructor(x, y) {
                super(x, y, 40, 64, sprites.player);
                this.velocityY = 0;
                this.isJumping = false;
            }

            jump() {
                if (!this.isJumping) {
                    this.velocityY = -15;
                    this.isJumping = true;
                    sounds.jump.play();
                }
            }

            update() {
                this.velocityY += 0.8; // Gravity
                this.y += this.velocityY;

                if (this.y > canvas.height - this.height) {
                    this.y = canvas.height - this.height;
                    this.velocityY = 0;
                    this.isJumping = false;
                }
            }
        }

        class Enemy extends Sprite {
            constructor(x, y) {
                super(x, y, 40, 60, sprites.enemy);
                this.speed = Math.random() * 2 + .6; //was 2+1
				//this.speed = 1.5;
            }

            update() {
                this.x -= this.speed;
                if (this.x < -this.width) {
                    this.x = canvas.width;
                    this.y = (canvas.height-60);Math.random() * (canvas.height - this.height);
                }
            }
        }

        class Bonus extends Sprite {
            constructor() {
                super(0, 0, 30, 30, [sprites.bonus]);
                this.respawn();
            }
			
			
            respawn() {
                this.x = Math.random() * (canvas.width - this.width);
                this.y = Math.random() * (canvas.height - this.height);
            }
        }

        function init() {
            player = new Player(50, canvas.height - 60);
            enemies = [
                new Enemy(canvas.width+200, canvas.height-60),//(canvas.width, Math.random() * (canvas.height - 60)),
                new Enemy(canvas.width, canvas.height-60)//(canvas.width + 400, Math.random() * (canvas.height - 60))
            ];
            bonuses = [new Bonus()];
            score = 0;
            timeLeft = GAME_TIME;
        }

        function update() {
            player.update();
            enemies.forEach(enemy => enemy.update());

            // Collision detection
            enemies.forEach(enemy => {
                if (collision(player, enemy)) {
                    if (player.y + player.height < enemy.y + enemy.height / 2) {
						// Player jumped on enemy
                        score += 100;
						enemy.x = canvas.width;
                        enemy.y = (canvas.height-60);//Math.random() * (canvas.height - enemy.height);
                        sounds.enemyDeath.play();
						createFloater(enemy); //player: works too
                    } else {
                        // Game over
                        endGame();
                    }
                }
            });

            bonuses.forEach(bonus => {
                if (collision(player, bonus)) {
                    score += 50;
                    bonus.respawn();
                    sounds.collect.play();
                }
            });

            timeLeft -= 1/60;
            if (timeLeft <= 0) {
                endGame();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw background
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            player.draw();
            enemies.forEach(enemy => enemy.draw());
            bonuses.forEach(bonus => bonus.draw());

            // Draw HUD
            const hudImg = new Image();
            hudImg.src = sprites.hud;
            ctx.drawImage(hudImg, 10, 10, 780, 50);

            ctx.fillStyle = '#ffffff';
            ctx.font = '16px "Press Start 2P"';
            ctx.fillText(`Score: ${score}`, 150, 45);
            ctx.fillText(`Time: ${Math.ceil(timeLeft)}`, 400, 45);
        }
		
		////////////////
		function createFloater(event) {
  const floater = document.createElement('div');
  floater.className = 'floater';
  floater.textContent = '+100';
  floater.style.left = `${event.clientX}px`;
  floater.style.top = `${event.clientY}px`;
  
  document.body.appendChild(floater);
  
  // Trigger the animation
  setTimeout(() => {
    floater.style.transform = 'translateY(-60px)';
    floater.style.opacity = '0';
  }, 50);
  
  // Remove the element after animation
  setTimeout(() => {
    document.body.removeChild(floater);
  }, 1050);
}
		///////////////

        function gameLoop() {
            update();
            draw();
           requestAnimationFrame(gameLoop);
        }

        function collision(a, b) {
            return a.x < b.x + b.width &&
                   a.x + a.width > b.x &&
                   a.y < b.y + b.height &&
                   a.y + a.height > b.y;
        }

        function startGame() {
            splashScreen.style.display = 'none';
            canvas.style.display = 'block';
            init();
            sounds.bgm.play();
            requestAnimationFrame(gameLoop);
        }

        function endGame() {
            cancelAnimationFrame(gameLoop);
            sounds.bgm.pause();
            sounds.bgm.currentTime = 0;
			sounds.gameOver.currentTime = 0;
            sounds.gameOver.play();
            canvas.style.display = 'none';
            gameOverScreen.style.display = 'flex';
            scoreElement.textContent = `Final Score: ${score}`;
			sounds.gameOver.addEventListener('ended', function() {
        this.currentTime = 0;
        this.pause();
    }, { once: true });
    
        }

        startButton.addEventListener('click', startGame);
        playAgainButton.addEventListener('click', startGame);

        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowUp' || e.code === 38) { //was 'space'
                player.jump();
            }
        });

        canvas.addEventListener('touchstart', () => {
            player.jump();
        });

        // Load Google Fonts
        const link = document.createElement('link');
        link.href = 'https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap';
        link.rel = 'stylesheet';
        document.head.appendChild(link);
    </script>
</body></html>